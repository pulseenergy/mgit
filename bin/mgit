#!/usr/bin/env node

var package_json = require(process.cwd() + '/package.json'),
	spawn = require('child_process').spawn,
	_ = require('underscore');

var args = process.argv.length > 2 ? _.rest(process.argv, 2) : [ 'status' ];

var linkedDependencies = [];
_.each(package_json.dependencies, function (val, key) {
	if (val.indexOf('git') > -1) {
		linkedDependencies.push(key);
	}
});

function spawnGitProcess (workingDir, args) {
	var git = spawn('git', args, { cwd: workingDir });
	git.stdout.on('data', function (data) {
		console.log('git ' + args + ' in ' + workingDir);
		console.log('' + data);
	});
	git.stderr.on('data', function (data) {
		console.log('error: ' + data);
	});
}

_.each(linkedDependencies, function (dep) {
	spawnGitProcess('../' + dep, args);
});
spawnGitProcess(process.cwd(), args);
